<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CowSwap Intent Order Demo</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    label { display: block; margin-top: 15px; }
    input { width: 100%; padding: 8px; box-sizing: border-box; }
    button { background-color: #007AFF; color: white; padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; margin-top: 20px; width: 100%; cursor: pointer; }
    #walletWarning { color: red; font-weight: bold; margin-top: 20px; display: none; }
    #guide { background-color: #f0f0f0; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
  </style>
</head>
<body>
  <h2>CowSwap Intent Order Demo</h2>
  
  <div id="walletWarning">
    <p>❌ 未检测到Web3钱包。</p>
  </div>

  <div id="guide">
    <h3>如何在iPhone上连接：</h3>
    <ol>
      <li>复制这个页面的网址。</li>
      <li>打开 <strong>MetaMask</strong> 或 <strong>Trust Wallet</strong> 等App。</li>
      <li>找到App内的 <strong>"浏览器"</strong> 功能。</li>
      <li>将网址粘贴到钱包浏览器的地址栏中打开。</li>
      <li>即可正常连接并使用。</li>
    </ol>
  </div>

  <label>Sell Token (WETH address): <input id="sellToken" value="0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"></label>
  <label>Buy Token (USDT address): <input id="buyToken" value="0xdAC17F958D2ee523a2206206994597C13D831ec7"></label>
  <label>Sell Amount (ETH): <input id="sellAmount" value="1.0"></label>
  <label>Buy Amount (USDT): <input id="buyAmount" value="3502"></label>
  <button id="submitBtn">Sign & Submit Order</button>

  <pre id="output"></pre>

  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <script>
    const apiBase = "https://api.cow.fi/mainnet/api/v1";
    const output = document.getElementById("output");
    const walletWarning = document.getElementById("walletWarning");
    const guide = document.getElementById("guide");

    // 页面加载时检测钱包
    window.addEventListener('load', async () => {
      // 检测是否在钱包环境中
      if (typeof window.ethereum === 'undefined') {
        walletWarning.style.display = 'block';
        guide.style.display = 'block';
        output.textContent = "请按照上方指引在钱包浏览器中打开此页面。";
      } else {
        output.textContent = "Web3钱包已检测到。可以继续操作。";
      }
    });

    async function submitOrder() {
      // 再次检测，防止用户没看指引直接点按钮
      if (typeof window.ethereum === 'undefined') {
        output.textContent = "错误：请务必在MetaMask等钱包的浏览器中打开此页面！";
        walletWarning.style.display = 'block';
        guide.style.display = 'block';
        return;
      }

      output.textContent = "Connecting wallet...";
      const provider = new ethers.providers.Web3Provider(window.ethereum);

      // ... 其余的原始代码保持不变 ...
      // [这里插入您原有的submitOrder函数其余部分的代码]

    }

    document.getElementById("submitBtn").addEventListener("click", submitOrder);
  </script>
</body>
</html>
